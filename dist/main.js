var e=Object.defineProperty,n=(n,t,o)=>(((n,t,o)=>{t in n?e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o})(n,"symbol"!=typeof t?t+"":t,o),o);function t(e){!function(e){e.select();var n=window.mainWorkspace,t=e.getRelativeToSurfaceXY(),o=n.getMetrics();n.scrollbar.set(t.x*n.scale-o.contentLeft-o.viewWidth,t.y*n.scale-o.contentTop-.1*o.viewHeight)}(window.mainWorkspace.getBlockById(e))}function o(){const e=$(".collapsedRuleInnerContainer");e.length&&async function(){const e=[];let n=window.modBlock.getChildren(!1)[0];for(;n;)e.push(n),n=n.nextConnection.targetBlock();return e}().then((n=>{e.children(".collapsedRule").remove(),n.forEach(((n,o)=>{const i=$("<div>",{class:"collapsedRule","data-block-id":n.id}).append($("<div>").text(o+1)).append($("<div>").text(function(e){if("ruleBlock"===e.type)return e.inputList[0].fieldRow[1].getValue()}(n)));i.on("click touch",(function(){t(this.getAttribute("data-block-id"))})),i.appendTo(e)}))}))}function i(){function e(){a.info("Starting Rules list plugin..."),window.mainWorkspace.addChangeListener((function(e){if(e.type==window.Blockly.Events.BLOCK_MOVE){const n=window.mainWorkspace.getBlockById(e.blockId);n&&"ruleBlock"===n.type&&o()}})),o()}a.info("Adding left plugin pannel");const n=$("<div></div>").load(c.getUrl("html/leftPluginPane.html"),(function(){$(".blocklyScrollbarHorizontal").after(n.html())}));let t;var i;(i="#leftPluginPage",new Promise((e=>{if(document.querySelector(i))return e(document.querySelector(i));const n=new MutationObserver((t=>{document.querySelector(i)&&(e(document.querySelector(i)),n.disconnect())}));n.observe(document.body,{childList:!0,subtree:!0})}))).then((function(n){const o=$(":root");o.css("--leftPageMarginLeft",`${$(".blocklyToolboxDiv").width()}px`),o.css("--collapsed-rule-bg-image-url",`url(${c.getUrl("static/images/rule_collapsed_no_name.svg")})`),o.css("--left-arrow-svg-url",`url(${c.getUrl("static/images/left_arrow.svg")})`),e(),t=$("#leftPaneOpenIconContainer")})),window.addEventListener("flyout_show_event",(function(e){t&&t.hide(0)})),window.addEventListener("flyout_hide_event",(function(e){t&&t.show(0)}))}function l(){const e=$("app-editor-menu mat-tree");e?$.get(c.getUrl("html/leftMenuButton.html"),(function(n){e.append(n)})).done((function(){const e=$("#cool_leftMenuButtonImage");e&&(e.attr("src",c.getUrl("static/images/leftMenuButton.svg")),$("#cool_leftMenuButton").on("click",(function(){a.info("Left Menu Button Clicked")})))})):a.critical("Couldn't find root menu tree")}const c=BF2042Portal.Plugins.getPlugin("1650e7b6-3676-4858-8c9c-95b9381b7f8c"),a=new class{constructor(e="",t=!1){n(this,"pluginName"),n(this,"showPluginName"),this.pluginName=e,this.showPluginName=t}fancyLog(e,n){e&&console.log(`${this.showPluginName?`${this.pluginName} : `:""}%c${e}`,`color: ${n}`)}info(e){this.fancyLog(e,"#26FFDF")}warn(e){this.fancyLog(e,"#F26A1B")}critical(e){this.fancyLog(e,"#FF2C10")}}(c.manifest.name),s=new CustomEvent("flyout_show_event",{detail:!0}),r=new CustomEvent("flyout_hide_event",{detail:!1});let u,d,_,f,g,p={},h=!1;function m(e){g.call(this,e),window.dispatchEvent(e?s:r)}function w(){var e;null==f&&(e="app-rules",new MutationObserver((function(e,n){f=n;for(const t of e)"childList"===t.type&&(document.getElementsByTagName("app-blockly").length||h&&(h=!1,n.disconnect(),f=void 0,a.warn("DOM recreated.... waiting to reload blockly specific plugins....")))})).observe("string"==typeof e?$(e)[0]:e,{childList:!0,subtree:!0})),h=!0}function y(){h=!1,a.info("\r\n\r\n   _____            _   _____  _             _           \r\n  / ____|          | | |  __ \\| |           (_)          \r\n | |     ___   ___ | | | |__) | |_   _  __ _ _ _ __  ___ \r\n | |    / _ \\ / _ \\| | |  ___/| | | | |/ _` | | '_ \\/ __|\r\n | |___| (_) | (_) | | | |    | | |_| | (_| | | | | \\__ \\\r\n  \\_____\\___/ \\___/|_| |_|    |_|\\__,_|\\__, |_|_| |_|___/\r\n                                        __/ |            \r\n                                       |___/             \r\n\n              Adding spice to your logic editor"),a.info("Setting Global Plugins Base variables..."),c.initializeWorkspace=function(){if(!h)try{!function(){if(a.info("Setting Blockly Plugins Base variables..."),u=_Blockly,d=u.getMainWorkspace()||void 0,d){_=_Blockly.getMainWorkspace().getBlocksByType("modBlock",!1)[0],p={},d.getToolbox().toolboxDef_.contents.forEach((e=>{"SEP"===e.kind||["SEARCH RESULTS","VARIABLES","SUBROUTINES","CONTROL ACTIONS"].includes(e.name)||e.contents.forEach((n=>{"LABEL"!==n.kind&&(e.name in p?p[e.name].push(n):p[e.name]=[n])}))}));let e=d.getFlyout();g=e.setVisible,e.setVisible=m,window.modBlock=_,window.allBlocks=p,window.mainWorkspace=d,window.menuInitlizer=l,window.Blockly=u}}(),d&&(i(),a.info("loading searchWithCategory plugin...."),$("input.searchbar").remove().clone().appendTo("span.searchbarspan").on("keyup",(function(e){setTimeout((function(){const e=window.mainWorkspace.getToolbox(),n=e.getToolboxItems()[0],t=$("input.searchbar").val().trim();if(t.length){let o=[],i=[];for(const[e,n]of Object.entries(window.allBlocks)){i=[];const l={kind:"LABEL",text:e};i.push(l),n.forEach((e=>{e.displayName.toLowerCase().includes(t.toLowerCase())&&i.push(e)})),i.length>1&&(o=o.concat(i))}n.updateFlyoutContents(o),n.show(),e.setSelectedItem(n)}else n.hide()}))}))),w()}catch(e){a.critical("Failed loading plugin... "+e)}},a.info("coolnesss loaded"),window.cool_plugin_loaded=!0}!function(){if(void 0===window.jQuery){const e=document.createElement("script");e.src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js",e.type="text/javascript",e.addEventListener("load",(()=>{console.log(`jQuery ${$.fn.jquery} has been loaded successfully!`),y()})),document.head.appendChild(e)}else y()}();
